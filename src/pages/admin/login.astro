---
import Layout from "../../layouts/Layout.astro";
---
<Layout title="Admin Login">
  <div class="flex justify-center items-center mt-20">
    <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md border border-gray-700">
      <h1 class="text-3xl font-bold text-center mb-6 text-white">Admin Login</h1>
      
      {/* Añadimos autocomplete="off" al formulario principal */}
      <form id="login-form" autocomplete="off">
        <div class="mb-4">
          <label for="email" class="block mb-2 text-white">Email</label>
          {/* Añadimos autocomplete="new-password" para despistar al navegador */}
          <input 
            type="email" 
            id="email" 
            class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white outline-none focus:border-blue-500" 
            required 
            autocomplete="off"
          />
        </div>
        <div class="mb-6">
          <label for="password" class="block mb-2 text-white">Contraseña</label>
          <input 
            type="password" 
            id="password" 
            class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white outline-none focus:border-blue-500" 
            required 
            autocomplete="new-password"
          />
        </div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors">Iniciar Sesión</button>
      </form>
      <p id="error-message" class="text-red-500 text-center mt-4"></p>
    </div>
  </div>
</Layout>

<style is:global>
  /* ¡LA CORRECCIÓN VISUAL CLAVE! */
  /* Este código obliga al navegador a mantener el fondo oscuro aunque autcomplete */
  input:-webkit-autofill,
  input:-webkit-autofill:hover, 
  input:-webkit-autofill:focus {
    -webkit-text-fill-color: white !important;
    -webkit-box-shadow: 0 0 0px 1000px #374151 inset !important; /* Color gray-700 */
    transition: background-color 5000s ease-in-out 0s;
  }
</style>

<script>
  import { auth } from "../../lib/firebase";
  import { signInWithEmailAndPassword } from "firebase/auth";

  const form = document.getElementById("login-form");
  const errorMessageElement = document.getElementById("error-message");

  if (form) {
    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      
      // Accedemos a los valores directamente (JavaScript puro)
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        await signInWithEmailAndPassword(auth, email, password);
        window.location.href = "/admin"; 
      } catch (error) {
        console.error("Error:", error);
        if (errorMessageElement) errorMessageElement.textContent = "Acceso denegado. Verifique sus datos.";
      }
    });
  }
</script>